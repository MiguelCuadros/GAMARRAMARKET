/* 7. Crear una conexión y acceder al servidor de base de datos con el usuario gmarket. */
/* 8. De acuerdo al siguiente diagrama físico crear las tablas y relaciones respectivas. */
-- CREACIÓN DE LAS TABLAS
CREATE TABLE persona
(
   IDPER INT GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 1 INCREMENT BY 1,
   DNIPER CHAR(8),
   NOMPER VARCHAR2(60),
   APEPER VARCHAR2(80),
   EMAPER VARCHAR2(80),
   CELPER CHAR(9),
   TIPPER CHAR(1),
   ESTPER CHAR(1) DEFAULT 'A',
   FECNACPER DATE,
   CONSTRAINT PER_PK PRIMARY KEY (IDPER)
);
COMMIT;

CREATE TABLE venta
(
    IDVEN INT GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 1 INCREMENT BY 1,
    FECVEN DATE,
    IDVEND INT,
    IDCLI INT,
    TIPPAGVEN CHAR(1),
    ESTVEN CHAR(1),
    CONSTRAINT VEN_PK PRIMARY KEY (IDVEN)
);
COMMIT;

CREATE TABLE venta_detalle
(
    IDVENDET INT GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 1 INCREMENT BY 1,
    IDVEN INT,
    CODPROD CHAR(3),
    CANVENDET INT,
    CONSTRAINT VEND_PK PRIMARY KEY (IDVENDET)
);
COMMIT;

CREATE TABLE producto
(
    CODPROD CHAR(3),
    NOMPRO VARCHAR2(50),
    IDCAT INT,
    PREPRO NUMBER(8,2),
    STOCKPRO INT,
    ESTPRO CHAR(1),
    CONSTRAINT PRO_PK PRIMARY KEY (CODPROD)
);
COMMIT;

CREATE TABLE categoria
(
    IDCAT INT GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 1 INCREMENT BY 1,
    NOMCAT VARCHAR2(60),
    CONSTRAINT CAT_PK PRIMARY KEY (IDCAT)
);
COMMIT;

-- RELACIONES
ALTER TABLE venta
    ADD CONSTRAINT FK_VENTA_VENDEDOR
    FOREIGN KEY (IDVEND)
    REFERENCES persona(IDPER);
COMMIT;

ALTER TABLE venta
    ADD CONSTRAINT FK_VENTA_CLIENTE
    FOREIGN KEY (IDCLI)
    REFERENCES persona(IDPER);
COMMIT;

ALTER TABLE venta_detalle
    ADD CONSTRAINT FK_VENTA_DETALLE_VENTA
    FOREIGN KEY (IDVEN)
    REFERENCES venta(IDVEN);
COMMIT;

ALTER TABLE venta_detalle
    ADD CONSTRAINT FK_VENTA_DETALLE_PRODUCTO
    FOREIGN KEY (CODPROD)
    REFERENCES producto(CODPROD);
COMMIT;

ALTER TABLE producto
    ADD CONSTRAINT FK_PRODUCTO_CATEGORIA
    FOREIGN KEY (IDCAT)
    REFERENCES categoria(IDCAT);
COMMIT;

/* 11. Listar las tablas creadas por el usuario gmarket. */
SELECT table_name
FROM user_tables;

/* 12. Listar las relaciones de cada tabla. */
SELECT 
   table_name, 
   constraint_name, 
   constraint_type, 
   r_owner, 
   r_constraint_name 
FROM user_constraints 
WHERE CONSTRAINT_TYPE = 'R';